<html>
<head>

</head>
<body style="padding: 0; margin: 0">


<canvas id="canvas" width="800" height="600" 
	style="
		width: 100%; height: 100%;
		grid-column: 1; grid-row: 1">
</canvas>

<span style="position: fixed; z-index: 100; left: 10px; top: 10px;">
	WebGPU Point Cloud rendering test. <br>
	#points: 3,954,696 (134MB)<br>
	More infos: <a href="https://github.com/m-schuetz/webgpu_pointcloud">github.com/m-schuetz/webgpu_pointcloud</a></a><br>
	<span id="progress"></span>
</span>

<script>

	async function* streamAsyncIterable(stream) {
		const reader = stream.getReader();
		try {
			while (true) {
			const { done, value } = await reader.read();
			if (done) {
				return;
			}
			yield value;
			}
		} finally {
			reader.releaseLock();
		}
	}

	async function run(){

		let tStart = performance.now();

		let response = await fetch("./heidentor.las");
		console.log(response);
		//let reader = response.body.getReader();

		let bytesRead = 0;
		for await(chunk of streamAsyncIterable(response.body)){

			bytesRead += chunk.byteLength;
			let mb = bytesRead / 1024 ** 2;

			console.log(`${mb}MB`);
		}
		
		let duration = performance.now() - tStart;
		console.log(`duration: ${duration}ms`);

		let mbs = (bytesRead / 1024 ** 2) / (duration / 1000);
		console.log(`${mbs}MB/s`);

	}

	async function runAtOnce(){
		let tStart = performance.now();

		let response = await fetch("./heidentor.las");
		let buffer = await response.arrayBuffer();

		//console.log(response);
		//let reader = response.body.getReader();
		let bytesRead = buffer.byteLength;
		
		let duration = performance.now() - tStart;
		console.log(`duration: ${duration}ms`);

		let mbs = (bytesRead / 1024 ** 2) / (duration / 1000);
		console.log(`${mbs}MB/s`);
	}

	// run();
	runAtOnce();


</script>


</body>
</html>